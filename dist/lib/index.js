#!/usr/bin/env node
"use strict";const e={react:{mini:"mini-template",pc:"pc-template",h5:"h5-template"},weapp:{js:"weapp-template",ts:"weapp-template-ts"},vue:{}};function t(e,t,n,s){return new(n||(n=Promise))((function(c,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function i(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}a((s=s.apply(e,t||[])).next())}))}const n=require("fs");const s=require("fs");function c(e,s){return t(this,void 0,void 0,(function*(){if("weapp"===e.lang)return yield function(e,t){return new Promise(((s,c)=>{try{const c=process.cwd()+`/${e.projectName}/project.config.json`,o=JSON.parse(n.readFileSync(c).toString("utf-8"));if(t.length>0){let s;s="ts"===e.type?`/${e.projectName}/miniprogram`:`/${e.projectName}`,n.rename(process.cwd()+`${s}/app.wxss`,process.cwd()+`${s}/app.${t[0]}`,(e=>{console.log(e)})),n.rename(process.cwd()+`${s}/components/ViscidGlobe/ViscidGlobe.wxss`,process.cwd()+`${s}/components/ViscidGlobe/ViscidGlobe.${t[0]}`,(e=>{console.log(e)})),n.rename(process.cwd()+`${s}/pages/index/index.wxss`,process.cwd()+`${s}/pages/index/index.${t[0]}`,(e=>{console.log(e)}))}t.forEach((e=>{o.setting.useCompilerPlugins.push(e)})),n.writeFileSync(c,Buffer.from(JSON.stringify(o,null,2),"utf-8")),s("success")}catch(e){console.log(e),c(e)}}))}(e,s)}))}function o(e){let t=[];s.existsSync(e)&&(t=s.readdirSync(e),t.forEach(((t,n)=>{const c=e+"/"+t;s.statSync(c).isDirectory()?o(c):s.unlinkSync(c)})),s.rmdirSync(e))}const r=require("single-line-log").stdout,i=require("chalk");class a{constructor(e={}){this.initConfig(e)}initConfig(e){const t={duration:100,current:0,block:"█",showNumber:!0,tip:{0:"努力构建中🔧……",50:"加载一半啦，不要着急🐶……",75:"马上就加载完了😊……",100:"创建完成🎆🎉,开始搬砖吧🧱😊"},color:"blue"};Object.assign(t,e),this.config=t}run(e){const{block:t,duration:n,tip:s,color:c,showNumber:o}=this.config,a=Object.keys(s).sort(((e,t)=>parseInt(t)-parseInt(e)));let p=s[0];const l=n/100,u=Math.floor(e/l);for(let e=0;e<a.length;e++)if(u>=parseInt(a[e])){p=s[a[e]];break}r(i[c](t.repeat(Math.floor(u/2)),(o?u+"% ":"")+p)),100===u&&console.log("")}}const p=require("cli-box");const l=require("chalk"),u=require("inquirer"),{exec:m}=require("child_process"),g=require("fs");function f(t){g.existsSync(t.projectName)&&(console.log(l.red(`file ${t.projectName} already exist！！！`)),process.exit());const n=t.type.split("+");t.type=n.shift();const s=n;let r=0;const i=new a,u=setInterval((()=>{i.run(r++),50===r&&clearInterval(u)}),100);var f,d;m(`git clone ${f=t.lang,d=t.type,`https://gitee.com/wukongyang/${e[f][d]}.git`} ${t.projectName}`,(e=>{e&&(console.log(e),process.exit()),i.run(75),m("rm -fr .git"),c(t,s).then((()=>{var e;i.run(100),console.log(l.green((e=t,new p({w:50,h:10,stringify:!1,marks:{nw:"╭",n:"─",ne:"╮",e:"│",se:"╯",s:"─",sw:"╰",w:"│"},hAlign:"center",vAlign:"center"},`\n    Create Project Success!😁\n    cd ${e.projectName}\n   \n   `)).stringify())),process.exit()})).catch((()=>{clearInterval(u),console.log(l.red(`create ${t.projectName} fail!!!`)),o(process.cwd()+`/${t.projectName}`)}))}))}const d={params:"[project-name]",description:"create a new project",action:e=>{const t=f;e?t(e):u.prompt([{type:"input",message:"项目名称:",name:"projectName",validate:e=>e&&e.trim()?!e.includes(" ")||l.red("项目名不能包含空格，请重新输入"):l.red("项目名不能为空，请重新输入")},{type:"list",message:"请选择你需要创建的模版",name:"lang",choices:["react","vue","weapp"]},{type:"list",message:"请选择你需要创建的模版",name:"type",when:e=>"weapp"===e.lang,choices:["ts","ts+less","ts+scss","js","js+less","js+scss"]},{type:"list",when:e=>"Vue"===e.lang,message:"请选择你需要创建的项目类型",name:"type",choices:["Vue-ssr","Vue-h5"]},{type:"list",when:e=>"react"===e.lang,message:"请选择你需要创建的项目类型",name:"type",choices:["pc","mini","h5"]}]).then((e=>{t(e)}))}},h=require("chalk"),w={create:d,version:{params:"[package-version]",description:"package version",action:()=>{console.log(h.green("1.0.1"))}}},{Command:y}=require("commander"),j=new y;Reflect.ownKeys(w).forEach((e=>{const{params:t,action:n,description:s}=w[e]||{};j.command(`${e} ${t||""}`).description(s).action((e=>{"function"==typeof n&&n(e)}))})),j.parse(process.argv);
